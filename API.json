{
  "openapi": "3.0.3",
  "info": {
    "title": "USST SPM 课程平台 API",
    "description": "与《项目计划.md》一致的 REST API，覆盖认证、课程、作业、出勤、讨论和统计模块。",
    "version": "1.0.0",
    "contact": {
      "name": "SPM 11开发团队"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8080/api/v1",
      "description": "开发环境"
    },
    {
      "url": "https://api.spm.usst.edu.cn/api/v1",
      "description": "生产环境"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "code": { "type": "integer", "example": 200 },
          "message": { "type": "string", "example": "success" },
          "data": { "type": "object" },
          "timestamp": { "type": "string", "format": "date-time" },
          "traceId": { "type": "string" }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "code": { "type": "integer", "example": 400 },
          "message": { "type": "string", "example": "参数错误" },
          "errors": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "field": { "type": "string" },
                "message": { "type": "string" }
              }
            }
          },
          "timestamp": { "type": "string", "format": "date-time" }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": ["studentNo", "password"],
        "properties": {
          "studentNo": { "type": "string", "description": "学号" },
          "password": { "type": "string", "minLength": 6, "description": "密码" }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 1 },
          "studentNo": { "type": "string", "example": "2021001", "description": "学号" },
          "name": { "type": "string", "example": "张三" },
          "role": { "type": "string", "enum": ["STUDENT", "TEACHER"], "example": "STUDENT" },
          "avatarUrl": { "type": "string" }
        }
      },
      "Assignment": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "title": { "type": "string" },
          "description": { "type": "string" },
          "type": { "type": "string", "example": "HOMEWORK" },
          "dueAt": { "type": "string", "format": "date-time" },
          "status": { "type": "string", "example": "ONGOING" }
        }
      },
      "SubmissionRequest": {
        "type": "object",
        "properties": {
          "content": { "type": "string" },
          "attachmentIds": {
            "type": "array",
            "items": { "type": "integer" }
          }
        }
      }
    }
  },
  "paths": {
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "账号登录",
        "description": "使用学号和密码登录平台",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/LoginRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "登录成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": { "type": "integer", "example": 200 },
                    "message": { "type": "string" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token": { "type": "string" },
                        "refreshToken": { "type": "string" },
                        "user": { "$ref": "#/components/schemas/User" }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "认证失败",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": ["Auth"],
        "summary": "刷新 Token",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "refreshToken": { "type": "string" }
                },
                "required": ["refreshToken"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "刷新成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/users/me": {
      "get": {
        "tags": ["User"],
        "summary": "获取当前用户",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/User" } } }
          }
        }
      },
      "put": {
        "tags": ["User"],
        "summary": "更新个人资料",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "avatarUrl": { "type": "string" },
                  "phone": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/course": {
      "get": {
        "tags": ["Course"],
        "summary": "获取课程信息（单课程）",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": { "type": "integer" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "integer" },
                        "name": { "type": "string" },
                        "code": { "type": "string" },
                        "semester": { "type": "string" },
                        "description": { "type": "string" },
                        "teacher": { "$ref": "#/components/schemas/User" }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/course/announcements": {
      "get": {
        "tags": ["Course"],
        "summary": "公告列表",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      },
      "post": {
        "tags": ["Course"],
        "summary": "发布公告（教师）",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["title", "content"],
                "properties": {
                  "title": { "type": "string" },
                  "content": { "type": "string" },
                  "visibleFrom": { "type": "string", "format": "date-time" },
                  "visibleTo": { "type": "string", "format": "date-time" }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "创建成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/assignments": {
      "get": {
        "tags": ["Assignment"],
        "summary": "作业列表",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "status", "in": "query", "schema": { "type": "string", "enum": ["ONGOING", "ENDED"] } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": { "type": "integer" },
                    "data": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Assignment" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/assignments/{assignmentId}": {
      "get": {
        "tags": ["Assignment"],
        "summary": "作业详情",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "assignmentId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Assignment" } } }
          }
        }
      }
    },
    "/assignments/{assignmentId}/submissions": {
      "post": {
        "tags": ["Assignment"],
        "summary": "提交作业",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "assignmentId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/SubmissionRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "提交成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/assignments/{assignmentId}/submissions/{submissionId}/grade": {
      "post": {
        "tags": ["Assignment"],
        "summary": "批改作业",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "assignmentId", "in": "path", "required": true, "schema": { "type": "integer" } },
          { "name": "submissionId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "score": { "type": "integer" },
                  "feedback": { "type": "string" },
                  "released": { "type": "boolean", "default": true }
                },
                "required": ["score"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "批改成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/attendance-sessions": {
      "post": {
        "tags": ["Attendance"],
        "summary": "创建考勤（教师）",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": { "type": "string" },
                  "mode": { "type": "string", "enum": ["CODE", "GEO"] },
                  "startAt": { "type": "string", "format": "date-time" },
                  "endAt": { "type": "string", "format": "date-time" },
                  "code": { "type": "string" }
                },
                "required": ["title", "mode", "startAt", "endAt"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "创建成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/attendance-sessions/{sessionId}/checkin": {
      "post": {
        "tags": ["Attendance"],
        "summary": "签到",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "sessionId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": { "type": "string" },
                  "location": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "签到成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/attendance-sessions/my": {
      "get": {
        "tags": ["Attendance"],
        "summary": "我的出勤记录（学生）",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/attendance-sessions/{sessionId}/records": {
      "get": {
        "tags": ["Attendance"],
        "summary": "考勤记录（教师）",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "sessionId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/discussions": {
      "get": {
        "tags": ["Discussion"],
        "summary": "帖子列表",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      },
      "post": {
        "tags": ["Discussion"],
        "summary": "发布帖子",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": { "type": "string" },
                  "content": { "type": "string" },
                  "attachmentIds": {
                    "type": "array",
                    "items": { "type": "integer" }
                  }
                },
                "required": ["title", "content"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "创建成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/discussions/{discussionId}/comments": {
      "get": {
        "tags": ["Discussion"],
        "summary": "评论列表",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "discussionId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      },
      "post": {
        "tags": ["Discussion"],
        "summary": "发表评论",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "discussionId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "content": { "type": "string" },
                  "parentId": { "type": "integer", "nullable": true }
                },
                "required": ["content"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/notifications": {
      "get": {
        "tags": ["Notification"],
        "summary": "获取通知",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "status", "in": "query", "schema": { "type": "string", "enum": ["UNREAD", "READ"] } },
          { "name": "type", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/notifications/{notificationId}/read": {
      "put": {
        "tags": ["Notification"],
        "summary": "标记已读",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "notificationId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/files": {
      "post": {
        "tags": ["File"],
        "summary": "上传文件",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": { "type": "string", "format": "binary" },
                  "type": { "type": "string" }
                },
                "required": ["file"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "上传成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/statistics/learning": {
      "get": {
        "tags": ["Statistics"],
        "summary": "学习统计（学生）",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    },
    "/statistics/course": {
      "get": {
        "tags": ["Statistics"],
        "summary": "课程统计（教师）",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SuccessResponse" } } }
          }
        }
      }
    }
  },
  "tags": [
    { "name": "Auth" },
    { "name": "User" },
    { "name": "Course" },
    { "name": "Assignment" },
    { "name": "Attendance" },
    { "name": "Discussion" },
    { "name": "Notification" },
    { "name": "File" },
    { "name": "Statistics" }
  ]
}

